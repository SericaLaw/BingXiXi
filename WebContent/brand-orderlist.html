<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">

    </head>
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/bootstrap-responsive.min.css">
    <link rel="stylesheet" href="css/font-awesome.min.css">
    <link rel="stylesheet" href="css/ace.min.css">
    <link rel="stylesheet" href="css/ace-skins.min.css">
    <link rel="stylesheet" href="css/ace-responsive.min.css">
  <style>
    body,html{
      width: 100%;
      height: 100%;
      background: #fff;
    }

    .info div{
        float: right;
    }

  </style>
    <body>

    <div id="main-content" class="clearfix">
  <div id="page-content" class="clearfix">

    <div class="page-header position-relative">
      <h1 style="color: #2679b5;">品牌商<small><i class="icon-double-angle-right"></i> 订单管理</small></h1>
    </div>
    <form class="form-search">
      商品标题：
      <input id="searchcontent" type="text" class="input-medium search-query">
      <button id="search" class="btn btn-purple btn-small">Search <i class="icon-search icon-on-right"></i></button>
    </form>

    <div id="item-table"></div>
    

    
  </div>
  </div>


    <script src="js/jquery-1.9.1.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/bootbox.min.js"></script>
	<script type="text/javascript">
	function sendOut() {
		var orderNumber=$(this).parents("tr").find("td").eq(5).text();
		console.log(orderNumber)
		var reqBody = {
			trackNumber: orderNumber
		}
		$.post("delivery.brand", JSON.stringify(reqBody), function(data){
			if (data == "true") {
			bootbox.alert("已发货!");
			}
			else {
			bootbox.alert("发货失败!");
			}
			buildPage();
		})
		
	}
	 
	function cancel(){
		var orderNumber=$(this).parents("tr").find("td").eq(5).text();
		var reqBody = {
			trackNumber: orderNumber
		}
		$.post("cancelOrder.borrow", JSON.stringify(reqBody), function(data){
			if (data == "true") {
				bootbox.alert("订单已取消!");
			}
			else {
				bootbox.alert("取消失败!");
			}
			buildPage();
		})
    }
	function buildPage() {
		
		var awaiting, delivered, completed, cancelled;
		$.get("requestWaitingForDeliveryList.brand", function(data) {
			data = JSON.parse(data);
			console.log(data)
			awaiting = data
			$.get("requesDeliveredList.brand", function(data) {
				data = JSON.parse(data);
				console.log(data)
				delivered = data
				$.get("requestcompletedList.brand", function(data) {
					data = JSON.parse(data);
					console.log(data)
					completed = data
					$.get("requestCanceledList.brand", function(data) {
						data = JSON.parse(data);
						console.log(data)
						cancelled = data
						var tabTable="<div class='tabbable'><ul class='nav nav-tabs' id='myTab'><li class='active'><a data-toggle='tab' href='#AwaitingPayment'> 待支付</a></li><li class=''><a data-toggle='tab' href='#AwaitingShipment'> 待发货</a></li><li class=''><a data-toggle='tab' href='#shipped'>已发货</a></li><li class=''><a data-toggle='tab' href='#complete'>已完成</a></li><li class=''><a data-toggle='tab' href='#canceled'>已取消</a></li></ul><div class='tab-content'>";
						var AwaitingPaymentTable="<div id='AwaitingPayment' class='tab-pane active'><p><table id='table_bug_report' class='table table-striped table-bordered table-hover'><thead><tr><th class='center'><label><input type='checkbox' class='ace-checkbox-2'><span class='lbl'></span></label></th><th>商品标题</th><th>价格</th><th class='hidden-480'>数量</th><th>sku</th><th class='hidden-480'>订单编号</th><th class='hidden-480'>订单创建时间</th></tr></thead><tbody>";
						var AwaitingShipmentTable="<div id='AwaitingShipment' class='tab-pane'><p><table id='table_bug_report' class='table table-striped table-bordered table-hover'><thead><tr><th class='center'><label><input type='checkbox' class='ace-checkbox-2'><span class='lbl'></span></label></th><th>商品标题</th><th>价格</th><th class='hidden-480'>数量</th><th>sku</th><th class='hidden-480'>订单编号</th><th class='hidden-480'>订单创建时间</th><th>操作</th></tr></thead><tbody>";
						var shippedTable="<div id='shipped' class='tab-pane'><p><table id='table_bug_report' class='table table-striped table-bordered table-hover'><thead><tr><th class='center'><label><input type='checkbox' class='ace-checkbox-2'><span class='lbl'></span></label></th><th>商品标题</th><th>价格</th><th class='hidden-480'>数量</th><th>sku</th><th>订单编号</th><th class='hidden-480'>订单创建时间</th><th class='hidden-480'>物流跟踪号</th><th>操作</th></tr></thead><tbody>";
						var completeTable="<div id='complete' class='tab-pane'><p><table id='table_bug_report' class='table table-striped table-bordered table-hover'><thead><tr><th class='center'><label><input type='checkbox' class='ace-checkbox-2'><span class='lbl'></span></label></th><th>商品标题</th><th>价格</th><th class='hidden-480'>数量</th><th>sku</th><th>订单编号</th><th class='hidden-480'>订单创建时间</th><th class='hidden-480'>物流跟踪号</th></tr></thead><tbody>";
						var canceledTable="<div id='canceled' class='tab-pane'><p><table id='table_bug_report' class='table table-striped table-bordered table-hover'><thead><tr><th class='center'><label><input type='checkbox' class='ace-checkbox-2'><span class='lbl'></span></label></th><th>商品标题</th><th>价格</th><th class='hidden-480'>数量</th><th>sku</th><th>订单编号</th><th class='hidden-480'>订单创建时间</th></tr></thead><tbody>";
						for (var i = 0, n = awaiting.length; i < n; ++i) {
							AwaitingPaymentTable+=`<tr><td class="center"><label><input type="checkbox" class="input"><span class="lbl"></span></label></td><td><a href="">`
								+awaiting[i].title
								+`</a></td><td>`
								+awaiting[i].price
								+`</td><td class="hidden-480">`
								+awaiting[i].qTY
								+`</td><td class="">`
								+awaiting[i].sku
								+`</td><td class="hidden-480">`
								+awaiting[i].orderNumber
								+`</td><td>`
								+awaiting[i].time
								+`</td></tr>`;
							AwaitingShipmentTable+=`<tr><td class="center"><label><input type="checkbox" class="input"><span class="lbl"></span></label></td><td><a href="">`
							+awaiting[i].title
							+`</a></td><td>`
							+awaiting[i].price
							+`</td><td class="hidden-480">`
							+awaiting[i].qTY
							+`</td><td class="">`
							+awaiting[i].sku
							+`</td><td class="hidden-480">`
							+awaiting[i].orderNumber
							+`</td><td>` + awaiting[i].time + `</td><td><button class="btn btn-minier btn-purple" onclick="sendOut()">发货</button></td></tr>`;
						}
						for (var i = 0, n = delivered.length; i < n; ++i) {
							shippedTable+=`<tr><td class="center"><label><input type="checkbox" class="input" ><span class="lbl"></span></label></td><td><a href="">`
								+delivered[i].name
								+`</a></td><td>`
								+delivered[i].price
								+`</td><td class="hidden-480">`
								+delivered[i].qTY
								+`</td><td>`
								+delivered[i].sku
								+`</td><td>`
								+delivered[i].orderNumber
								+`</td><td>`
								+delivered[i].time
								+`</td><td><a href="">`
								+delivered[i].trackNumber
								+`</a></td><td><button class="btn btn-minier btn-yellow" onclick=cancel()>取消</button></td></tr>`;
						}
						for (var i = 0, n = completed.length; i < n; ++i) {
							completeTable+=`<tr><td class="center"><label><input type="checkbox" class="input"><span class="lbl"></span></label></td><td><a href="">`
								+completed[i].name
								+`</a></td><td>`
								+completed[i].price
								+`</td><td class="hidden-480">`
								+completed[i].qTY
								+`</td><td>`
								+completed[i].sku
								+`</td><td>`
								+completed[i].orderNumber
								+`</td><td class="hidden-phone">`
								+completed[i].time
								+`</td><td class="hidden-480"><a href="">`
								+completed[i].trackNumber
								+`</a></td></tr>`;
						}
						for (var i = 0, n = cancelled.length; i < n; ++i) {
							canceledTable+=`<tr><td class="center"><label><input type="checkbox" class="input"><span class="lbl"></span></label></td><td><a href="">`
								+cancelled[i].name
								+`</a></td><td>`
								+cancelled[i].price
								+`</td><td class="hidden-480">`
								+cancelled[i].qTY
								+`</td><td class="hidden-phone">`
								+cancelled[i].sku
								+`</td><td class="hidden-480">`
								+cancelled[i].orderNumber
								+`</td><td>` +cancelled[i].time + `</td></tr>`;
							
						}
						
						AwaitingPaymentTable+="</tbody></table></p></div>";
						AwaitingShipmentTable+="</tbody></table></p></div>";
						shippedTable+="</tbody></table></p></div>";
						completeTable+="</tbody></table></p></div>";
						canceledTable+="</tbody></table></p></div>";
						tabTable+=AwaitingPaymentTable+AwaitingShipmentTable+shippedTable+completeTable+canceledTable;
						tabTable+="</div></div>";
						$("#item-table").html(tabTable);
					});
				});
			});
		
		
		});
		
    	
	}
    $(document).ready(function(){
    	buildPage()
    })
    </script>


    <script>
		

      $(function(){

        $('.ace-checkbox-2').each(function(){
              $('.ace-checkbox-2').change(function(){
                if($(this).prop('checked')){
                 $(this).parents('.tab-pane').find('.input').prop('checked',true);
               }else{
                $(this).parents('.tab-pane').find('.input').prop('checked',false);
              }
          })

        })
      
        
      $('#search').click(function(e){
        e.preventDefault();
        var sstxt=$('#searchcontent').val();
        if (sstxt == "") {
        	$("table tbody tr")
            .hide()
            .show();
        }
        else {
        	 $("table tbody tr")
             .hide()
             .filter(":contains('"+sstxt+"')")
             .show();
        }
       
     })
        





})



    </script>
    </body>
</html>
